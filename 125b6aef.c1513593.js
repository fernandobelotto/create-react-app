(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{113:function(e,t,o){"use strict";o.d(t,"a",(function(){return b})),o.d(t,"b",(function(){return m}));var a=o(0),n=o.n(a);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function c(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var s=n.a.createContext({}),l=function(e){var t=n.a.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):p(p({},t),e)),o},b=function(e){var t=l(e.components);return n.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},u=n.a.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=l(o),u=a,m=b["".concat(i,".").concat(u)]||b[u]||d[u]||r;return o?n.a.createElement(m,p(p({ref:t},s),{},{components:o})):n.a.createElement(m,p({ref:t},s))}));function m(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=u;var p={};for(var c in t)hasOwnProperty.call(t,c)&&(p[c]=t[c]);p.originalType=e,p.mdxType="string"==typeof e?e:a,i[1]=p;for(var s=2;s<r;s++)i[s]=o[s];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,o)}u.displayName="MDXCreateElement"},57:function(e,t,o){"use strict";o.r(t),o.d(t,"frontMatter",(function(){return i})),o.d(t,"metadata",(function(){return p})),o.d(t,"rightToc",(function(){return c})),o.d(t,"default",(function(){return l}));var a=o(2),n=o(6),r=(o(0),o(113)),i={id:"proxying-api-requests-in-development",title:"Solicita\xe7\xf5es de proxy de API em desenvolvimento",sidebar_label:"Proxying in Development"},p={unversionedId:"proxying-api-requests-in-development",id:"proxying-api-requests-in-development",isDocsHomePage:!1,title:"Solicita\xe7\xf5es de proxy de API em desenvolvimento",description:"Note: this feature is available with react-scripts@0.2.3 and higher.",source:"@site/..\\docs\\proxying-api-requests-in-development.md",slug:"/proxying-api-requests-in-development",permalink:"/create-react-app/docs/proxying-api-requests-in-development",editUrl:"https://github.com/facebook/create-react-app/edit/master/docusaurus/website/../docs/proxying-api-requests-in-development.md",version:"current",lastUpdatedBy:"Fernando Belotto",lastUpdatedAt:1609702716,sidebar_label:"Proxying in Development",sidebar:"docs",previous:{title:"Debugging Tests",permalink:"/create-react-app/docs/debugging-tests"},next:{title:"Fetch de dados com solicita\xe7\xf5es AJAX",permalink:"/create-react-app/docs/fetching-data-with-ajax-requests"}},c=[{value:"Erros &quot;Invalid Host Header&quot; ap\xf3s configurar o proxy",id:"erros-invalid-host-header-ap\xf3s-configurar-o-proxy",children:[]},{value:"Configurando o Proxy Manualmente",id:"configurando-o-proxy-manualmente",children:[]}],s={rightToc:c};function l(e){var t=e.components,o=Object(n.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,o,{components:t,mdxType:"MDXLayout"}),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Note: this feature is available with ",Object(r.b)("inlineCode",{parentName:"p"},"react-scripts@0.2.3")," and higher.")),Object(r.b)("p",null,"People often serve the front-end React app from the same host and port as their backend implementation.\nMuitas vezes, as pessoas veiculam o aplicativo React de front-end no mesmo host e porta de sua implementa\xe7\xe3o de back-end."),Object(r.b)("p",null,"For example, a production setup might look like this after the app is deployed:\nPor exemplo, um setup de produ\xe7\xe3o pode ter esta apar\xeancia depois que o aplicativo \xe9 implantado:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"/             - o servidor est\xe1tico retorna index.html com o aplicativo React\n/todos        - o servidor est\xe1tico retorna index.html com o aplicativo React\n/api/todos    - servidor lida com quaisquer solicita\xe7\xf5es /api/* usando a implementa\xe7\xe3o de backend\n")),Object(r.b)("p",null,"Essa configura\xe7\xe3o ",Object(r.b)("strong",{parentName:"p"},"n\xe3o")," \xe9 necess\xe1ria. No entanto, se voc\xea ",Object(r.b)("strong",{parentName:"p"},"tiver")," uma configura\xe7\xe3o como esta, \xe9 conveniente escrever pedidos como ",Object(r.b)("inlineCode",{parentName:"p"},"fetch('/api/todos')")," sem se preocupar em redirecion\xe1-los para outro host ou porta durante o desenvolvimento."),Object(r.b)("p",null,"To tell the development server to proxy any unknown requests to your API server in development, add a ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," field to your ",Object(r.b)("inlineCode",{parentName:"p"},"package.json"),", for example:\nPara dizer ao servidor de desenvolvimento para fazer proxy de quaisquer solicita\xe7\xf5es desconhecidas para seu servidor em desenvolvimento, adicione um campo ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," ao seu ",Object(r.b)("inlineCode",{parentName:"p"},"package.json"),", por exemplo:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'  "proxy": "http://localhost:4000",\n')),Object(r.b)("p",null,"Desta forma, quando voc\xea executar ",Object(r.b)("inlineCode",{parentName:"p"},"fetch('/api/todos')")," no desenvolvimento, o servidor de desenvolvimento reconhecer\xe1 que n\xe3o \xe9 um asset est\xe1tico e enviar\xe1 o proxy de sua solicita\xe7\xe3o para ",Object(r.b)("inlineCode",{parentName:"p"},"http://localhost:4000/api/todos")," como uma alternativa. O servidor de desenvolvimento ",Object(r.b)("strong",{parentName:"p"},"apenas")," tentar\xe1 enviar solicita\xe7\xf5es sem ",Object(r.b)("inlineCode",{parentName:"p"},"text/html")," em seu cabe\xe7alho ",Object(r.b)("inlineCode",{parentName:"p"},"Accept")," para o proxy."),Object(r.b)("p",null,"Convenientemente, isso evita ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://stackoverflow.com/questions/21854516/understanding-ajax-cors-and-security-considerations"}),"problemas de CORS")," e mensagens de erro como esta em desenvolvimento:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"Fetch API cannot load http://localhost:4000/api/todos. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:3000' is therefore not allowed access. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n")),Object(r.b)("p",null,"Lembre-se de que ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," s\xf3 tem efeito no desenvolvimento (com ",Object(r.b)("inlineCode",{parentName:"p"},"npm start"),"), e cabe a voc\xea garantir que URLs como ",Object(r.b)("inlineCode",{parentName:"p"},"/api/todos")," apontem para o endpoint certo na produ\xe7\xe3o. Voc\xea n\xe3o precisa usar o prefixo ",Object(r.b)("inlineCode",{parentName:"p"},"/api"),". Qualquer solicita\xe7\xe3o n\xe3o reconhecida sem um cabe\xe7alho de aceita\xe7\xe3o ",Object(r.b)("inlineCode",{parentName:"p"},"text/html")," ser\xe1 redirecionada para o ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," especificado.\nA op\xe7\xe3o ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," suporta conex\xf5es HTTP, HTTPS e WebSocket."),Object(r.b)("p",null,"Se a op\xe7\xe3o ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," ",Object(r.b)("strong",{parentName:"p"},"n\xe3o")," for flex\xedvel o suficiente para voc\xea, alternativamente, voc\xea pode:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"#configurando-o-proxy-manualmente"}),"Configure o proxy voc\xea mesmo")),Object(r.b)("li",{parentName:"ul"},"Habilite o CORS em seu servidor (",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://enable-cors.org/server_expressjs.html"}),"aqui est\xe1 como faz\xea-lo com o Express"),")."),Object(r.b)("li",{parentName:"ul"},"Use ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"/create-react-app/docs/adding-custom-environment-variables"}),"vari\xe1veis \u200b\u200bde ambiente")," para injetar o host de servidor e a porta correta em seu aplicativo.")),Object(r.b)("h2",{id:"erros-invalid-host-header-ap\xf3s-configurar-o-proxy"},'Erros "Invalid Host Header" ap\xf3s configurar o proxy'),Object(r.b)("p",null,"When you enable the ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," option, you opt into a more strict set of host checks. This is necessary because leaving the backend open to remote hosts makes your computer vulnerable to DNS rebinding attacks. The issue is explained in ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://medium.com/webpack/webpack-dev-server-middleware-security-issues-1489d950874a"}),"this article")," and ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/webpack/webpack-dev-server/issues/887"}),"this issue"),"."),Object(r.b)("p",null,"This shouldn\u2019t affect you when developing on ",Object(r.b)("inlineCode",{parentName:"p"},"localhost"),", but if you develop remotely like ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/issues/2271"}),"described here"),", you will see this error in the browser after enabling the ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," option:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Invalid Host header")),Object(r.b)("p",null,"To work around it, you can specify your public development host in a file called ",Object(r.b)("inlineCode",{parentName:"p"},".env.development")," in the root of your project:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"HOST=mypublicdevhost.com\n")),Object(r.b)("p",null,"If you restart the development server now and load the app from the specified host, it should work."),Object(r.b)("p",null,"If you are still having issues or if you\u2019re using a more exotic environment like a cloud editor, you can bypass the host check completely by adding a line to ",Object(r.b)("inlineCode",{parentName:"p"},".env.development.local"),". ",Object(r.b)("strong",{parentName:"p"},"Note that this is dangerous and exposes your machine to remote code execution from malicious websites:")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"# NOTE: THIS IS DANGEROUS!\n# It exposes your machine to attacks from the websites you visit.\nDANGEROUSLY_DISABLE_HOST_CHECK=true\n")),Object(r.b)("p",null,"We don\u2019t recommend this approach."),Object(r.b)("h2",{id:"configurando-o-proxy-manualmente"},"Configurando o Proxy Manualmente"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Note: this feature is available with ",Object(r.b)("inlineCode",{parentName:"p"},"react-scripts@2.0.0")," and higher.")),Object(r.b)("p",null,"If the ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," option is ",Object(r.b)("strong",{parentName:"p"},"not")," flexible enough for you, you can get direct access to the Express app instance and hook up your own proxy middleware."),Object(r.b)("p",null,"You can use this feature in conjunction with the ",Object(r.b)("inlineCode",{parentName:"p"},"proxy")," property in ",Object(r.b)("inlineCode",{parentName:"p"},"package.json"),", but it is recommended you consolidate all of your logic into ",Object(r.b)("inlineCode",{parentName:"p"},"src/setupProxy.js"),"."),Object(r.b)("p",null,"First, install ",Object(r.b)("inlineCode",{parentName:"p"},"http-proxy-middleware")," using npm or Yarn:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"$ npm install http-proxy-middleware --save\n$ # ou\n$ yarn add http-proxy-middleware\n")),Object(r.b)("p",null,"Next, create ",Object(r.b)("inlineCode",{parentName:"p"},"src/setupProxy.js")," and place the following contents in it:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const { createProxyMiddleware } = require('http-proxy-middleware');\n\nmodule.exports = function(app) {\n  // ...\n};\n")),Object(r.b)("p",null,"Agora voc\xea pode registrar proxies como desejar! Aqui est\xe1 um exemplo usando o ",Object(r.b)("inlineCode",{parentName:"p"},"http-proxy-middleware")," acima:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const { createProxyMiddleware } = require('http-proxy-middleware');\n\nmodule.exports = function(app) {\n  app.use(\n    '/api',\n    createProxyMiddleware({\n      target: 'http://localhost:5000',\n      changeOrigin: true,\n    })\n  );\n};\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Nota:")," Voc\xea n\xe3o precisa importar este arquivo para lugar nenhum. Ele \xe9 registrado automaticamente quando voc\xea inicia o servidor de desenvolvimento.")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Nota:")," Este arquivo suporta apenas a sintaxe JavaScript do Node. Certifique-se de usar apenas recursos de idioma compat\xedveis (ou seja, sem suporte para Flow, M\xf3dulos ES, etc.).")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Nota:")," Passar o caminho para a fun\xe7\xe3o proxy permite que voc\xea use globbing e/ou correspond\xeancia de padr\xf5es no caminho, que \xe9 mais flex\xedvel do que a correspond\xeancia de rota expressa.")))}l.isMDXComponent=!0}}]);