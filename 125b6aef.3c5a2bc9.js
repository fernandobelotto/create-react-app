(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{113:function(e,o,t){"use strict";t.d(o,"a",(function(){return d})),t.d(o,"b",(function(){return m}));var a=t(0),r=t.n(a);function n(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}function i(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);o&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,a)}return t}function c(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?i(Object(t),!0).forEach((function(o){n(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function p(e,o){if(null==e)return{};var t,a,r=function(e,o){if(null==e)return{};var t,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)t=n[a],o.indexOf(t)>=0||(r[t]=e[t]);return r}(e,o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)t=n[a],o.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=r.a.createContext({}),l=function(e){var o=r.a.useContext(s),t=o;return e&&(t="function"==typeof e?e(o):c(c({},o),e)),t},d=function(e){var o=l(e.components);return r.a.createElement(s.Provider,{value:o},e.children)},b={inlineCode:"code",wrapper:function(e){var o=e.children;return r.a.createElement(r.a.Fragment,{},o)}},u=r.a.forwardRef((function(e,o){var t=e.components,a=e.mdxType,n=e.originalType,i=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),d=l(t),u=a,m=d["".concat(i,".").concat(u)]||d[u]||b[u]||n;return t?r.a.createElement(m,c(c({ref:o},s),{},{components:t})):r.a.createElement(m,c({ref:o},s))}));function m(e,o){var t=arguments,a=o&&o.mdxType;if("string"==typeof e||a){var n=t.length,i=new Array(n);i[0]=u;var c={};for(var p in o)hasOwnProperty.call(o,p)&&(c[p]=o[p]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var s=2;s<n;s++)i[s]=t[s];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},57:function(e,o,t){"use strict";t.r(o),t.d(o,"frontMatter",(function(){return i})),t.d(o,"metadata",(function(){return c})),t.d(o,"rightToc",(function(){return p})),t.d(o,"default",(function(){return l}));var a=t(2),r=t(6),n=(t(0),t(113)),i={id:"proxying-api-requests-in-development",title:"Solicita\xe7\xf5es de proxy de API em desenvolvimento",sidebar_label:"Proxying em desenvolvimento"},c={unversionedId:"proxying-api-requests-in-development",id:"proxying-api-requests-in-development",isDocsHomePage:!1,title:"Solicita\xe7\xf5es de proxy de API em desenvolvimento",description:"Note: this feature is available with react-scripts@0.2.3 and higher.",source:"@site/..\\docs\\proxying-api-requests-in-development.md",slug:"/proxying-api-requests-in-development",permalink:"/create-react-app/docs/proxying-api-requests-in-development",editUrl:"https://github.com/facebook/create-react-app/edit/master/docusaurus/website/../docs/proxying-api-requests-in-development.md",version:"current",lastUpdatedBy:"Fernando Belotto",lastUpdatedAt:1609711939,sidebar_label:"Proxying em desenvolvimento",sidebar:"docs",previous:{title:"Depurando testes",permalink:"/create-react-app/docs/debugging-tests"},next:{title:"Fetch de dados com solicita\xe7\xf5es AJAX",permalink:"/create-react-app/docs/fetching-data-with-ajax-requests"}},p=[{value:"Erros &quot;Invalid Host Header&quot; ap\xf3s configurar o proxy",id:"erros-invalid-host-header-ap\xf3s-configurar-o-proxy",children:[]},{value:"Configurando o Proxy Manualmente",id:"configurando-o-proxy-manualmente",children:[]}],s={rightToc:p};function l(e){var o=e.components,t=Object(r.a)(e,["components"]);return Object(n.b)("wrapper",Object(a.a)({},s,t,{components:o,mdxType:"MDXLayout"}),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"Note: this feature is available with ",Object(n.b)("inlineCode",{parentName:"p"},"react-scripts@0.2.3")," and higher.")),Object(n.b)("p",null,"People often serve the front-end React app from the same host and port as their backend implementation.\nMuitas vezes, as pessoas veiculam o aplicativo React de front-end no mesmo host e porta de sua implementa\xe7\xe3o de back-end."),Object(n.b)("p",null,"For example, a production setup might look like this after the app is deployed:\nPor exemplo, um setup de produ\xe7\xe3o pode ter esta apar\xeancia depois que o aplicativo \xe9 implantado:"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{}),"/             - o servidor est\xe1tico retorna index.html com o aplicativo React\n/todos        - o servidor est\xe1tico retorna index.html com o aplicativo React\n/api/todos    - servidor lida com quaisquer solicita\xe7\xf5es /api/* usando a implementa\xe7\xe3o de backend\n")),Object(n.b)("p",null,"Essa configura\xe7\xe3o ",Object(n.b)("strong",{parentName:"p"},"n\xe3o")," \xe9 necess\xe1ria. No entanto, se voc\xea ",Object(n.b)("strong",{parentName:"p"},"tiver")," uma configura\xe7\xe3o como esta, \xe9 conveniente escrever pedidos como ",Object(n.b)("inlineCode",{parentName:"p"},"fetch('/api/todos')")," sem se preocupar em redirecion\xe1-los para outro host ou porta durante o desenvolvimento."),Object(n.b)("p",null,"To tell the development server to proxy any unknown requests to your API server in development, add a ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," field to your ",Object(n.b)("inlineCode",{parentName:"p"},"package.json"),", for example:\nPara dizer ao servidor de desenvolvimento para fazer proxy de quaisquer solicita\xe7\xf5es desconhecidas para seu servidor em desenvolvimento, adicione um campo ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," ao seu ",Object(n.b)("inlineCode",{parentName:"p"},"package.json"),", por exemplo:"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'  "proxy": "http://localhost:4000",\n')),Object(n.b)("p",null,"Desta forma, quando voc\xea executar ",Object(n.b)("inlineCode",{parentName:"p"},"fetch('/api/todos')")," no desenvolvimento, o servidor de desenvolvimento reconhecer\xe1 que n\xe3o \xe9 um asset est\xe1tico e enviar\xe1 o proxy de sua solicita\xe7\xe3o para ",Object(n.b)("inlineCode",{parentName:"p"},"http://localhost:4000/api/todos")," como uma alternativa. O servidor de desenvolvimento ",Object(n.b)("strong",{parentName:"p"},"apenas")," tentar\xe1 enviar solicita\xe7\xf5es sem ",Object(n.b)("inlineCode",{parentName:"p"},"text/html")," em seu cabe\xe7alho ",Object(n.b)("inlineCode",{parentName:"p"},"Accept")," para o proxy."),Object(n.b)("p",null,"Convenientemente, isso evita ",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://stackoverflow.com/questions/21854516/understanding-ajax-cors-and-security-considerations"}),"problemas de CORS")," e mensagens de erro como esta em desenvolvimento:"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{}),"Fetch API cannot load http://localhost:4000/api/todos. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:3000' is therefore not allowed access. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n")),Object(n.b)("p",null,"Lembre-se de que ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," s\xf3 tem efeito no desenvolvimento (com ",Object(n.b)("inlineCode",{parentName:"p"},"npm start"),"), e cabe a voc\xea garantir que URLs como ",Object(n.b)("inlineCode",{parentName:"p"},"/api/todos")," apontem para o endpoint certo na produ\xe7\xe3o. Voc\xea n\xe3o precisa usar o prefixo ",Object(n.b)("inlineCode",{parentName:"p"},"/api"),". Qualquer solicita\xe7\xe3o n\xe3o reconhecida sem um cabe\xe7alho de aceita\xe7\xe3o ",Object(n.b)("inlineCode",{parentName:"p"},"text/html")," ser\xe1 redirecionada para o ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," especificado.\nA op\xe7\xe3o ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," suporta conex\xf5es HTTP, HTTPS e WebSocket."),Object(n.b)("p",null,"Se a op\xe7\xe3o ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," ",Object(n.b)("strong",{parentName:"p"},"n\xe3o")," for flex\xedvel o suficiente para voc\xea, alternativamente, voc\xea pode:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("a",Object(a.a)({parentName:"li"},{href:"#configurando-o-proxy-manualmente"}),"Configure o proxy voc\xea mesmo")),Object(n.b)("li",{parentName:"ul"},"Habilite o CORS em seu servidor (",Object(n.b)("a",Object(a.a)({parentName:"li"},{href:"https://enable-cors.org/server_expressjs.html"}),"aqui est\xe1 como faz\xea-lo com o Express"),")."),Object(n.b)("li",{parentName:"ul"},"Use ",Object(n.b)("a",Object(a.a)({parentName:"li"},{href:"/create-react-app/docs/adding-custom-environment-variables"}),"vari\xe1veis \u200b\u200bde ambiente")," para injetar o host de servidor e a porta correta em seu aplicativo.")),Object(n.b)("h2",{id:"erros-invalid-host-header-ap\xf3s-configurar-o-proxy"},'Erros "Invalid Host Header" ap\xf3s configurar o proxy'),Object(n.b)("p",null,"Ao habilitar a op\xe7\xe3o ",Object(n.b)("inlineCode",{parentName:"p"},"proxy"),", voc\xea opta por um conjunto mais restrito de verifica\xe7\xf5es de host. Isso \xe9 necess\xe1rio porque deixar o back-end aberto para hosts remotos e torna seu computador vulner\xe1vel a ataques de religa\xe7\xe3o de DNS. O problema \xe9 explicado ",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://medium.com/webpack/webpack-dev-server-middleware-security-issues-1489d950874a"}),"neste artigo")," e ",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/webpack/webpack-dev-server/issues/887"}),"esta issue"),"."),Object(n.b)("p",null,"Isso n\xe3o deve afet\xe1-lo ao desenvolver em ",Object(n.b)("inlineCode",{parentName:"p"},"localhost"),", mas se voc\xea desenvolver remotamente como ",Object(n.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/issues/2271"}),"descrito aqui"),", voc\xea ver\xe1 este erro no navegador ap\xf3s habilitar a op\xe7\xe3o ",Object(n.b)("inlineCode",{parentName:"p"},"proxy"),":"),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"Invalid Host header")),Object(n.b)("p",null,"Para contornar isso, voc\xea pode especificar seu host de desenvolvimento p\xfablico em um arquivo chamado ",Object(n.b)("inlineCode",{parentName:"p"},".env.development")," na raiz do seu projeto:"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{}),"HOST=mypublicdevhost.com\n")),Object(n.b)("p",null,"Se voc\xea reiniciar o servidor de desenvolvimento agora e carregar o aplicativo do host especificado, ele deve funcionar."),Object(n.b)("p",null,"Se ainda estiver tendo problemas ou se estiver usando um ambiente mais ex\xf3tico como um editor de nuvem, voc\xea pode ignorar a verifica\xe7\xe3o do host completamente adicionando uma linha a ",Object(n.b)("inlineCode",{parentName:"p"},".env.development.local"),". ",Object(n.b)("strong",{parentName:"p"},"Observe que isso \xe9 perigoso e exp\xf5e sua m\xe1quina \xe0 execu\xe7\xe3o remota de c\xf3digo de sites maliciosos:")),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{}),"# NOTA: ISTO \xc9 PERIGOSO!\n# Exp\xf5e sua m\xe1quina a ataques dos sites que voc\xea visita.\nDANGEROUSLY_DISABLE_HOST_CHECK=true\n")),Object(n.b)("p",null,"N\xe3o recomendamos essa abordagem."),Object(n.b)("h2",{id:"configurando-o-proxy-manualmente"},"Configurando o Proxy Manualmente"),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"Nota: este recurso est\xe1 dispon\xedvel com ",Object(n.b)("inlineCode",{parentName:"p"},"react-scripts@2.0.0")," e superior.")),Object(n.b)("p",null,"Se a op\xe7\xe3o ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," ",Object(n.b)("strong",{parentName:"p"},"n\xe3o")," for flex\xedvel o suficiente para voc\xea, voc\xea pode obter acesso direto \xe0 inst\xe2ncia do aplicativo Express e conectar seu pr\xf3prio middleware de proxy."),Object(n.b)("p",null,"Voc\xea pode usar este recurso em conjunto com a propriedade ",Object(n.b)("inlineCode",{parentName:"p"},"proxy")," em ",Object(n.b)("inlineCode",{parentName:"p"},"package.json"),", mas \xe9 recomendado que voc\xea consolide toda a sua l\xf3gica em ",Object(n.b)("inlineCode",{parentName:"p"},"src/setupProxy.js"),"."),Object(n.b)("p",null,"Primeiro, instale ",Object(n.b)("inlineCode",{parentName:"p"},"http-proxy-middleware")," usando npm ou Yarn:"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"$ npm install http-proxy-middleware --save\n$ # ou\n$ yarn add http-proxy-middleware\n")),Object(n.b)("p",null,"Em seguida, crie o arquivo em ",Object(n.b)("inlineCode",{parentName:"p"},"src/setupProxy.js")," e coloque o seguinte conte\xfado nele:"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const { createProxyMiddleware } = require('http-proxy-middleware');\n\nmodule.exports = function(app) {\n  // ...\n};\n")),Object(n.b)("p",null,"Agora voc\xea pode registrar proxies como desejar! Aqui est\xe1 um exemplo usando o ",Object(n.b)("inlineCode",{parentName:"p"},"http-proxy-middleware")," acima:"),Object(n.b)("pre",null,Object(n.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const { createProxyMiddleware } = require('http-proxy-middleware');\n\nmodule.exports = function(app) {\n  app.use(\n    '/api',\n    createProxyMiddleware({\n      target: 'http://localhost:5000',\n      changeOrigin: true,\n    })\n  );\n};\n")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"Nota:")," Voc\xea n\xe3o precisa importar este arquivo para lugar nenhum. Ele \xe9 registrado automaticamente quando voc\xea inicia o servidor de desenvolvimento.")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"Nota:")," Este arquivo suporta apenas a sintaxe JavaScript do Node. Certifique-se de usar apenas recursos de idioma compat\xedveis (ou seja, sem suporte para Flow, M\xf3dulos ES, etc.).")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"Nota:")," Passar o caminho para a fun\xe7\xe3o proxy permite que voc\xea use globbing e/ou correspond\xeancia de padr\xf5es no caminho, que \xe9 mais flex\xedvel do que a correspond\xeancia de rota expressa.")))}l.isMDXComponent=!0}}]);