(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{113:function(e,a,o){"use strict";o.d(a,"a",(function(){return d})),o.d(a,"b",(function(){return u}));var r=o(0),t=o.n(r);function i(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function s(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,r)}return o}function n(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?s(Object(o),!0).forEach((function(a){i(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function c(e,a){if(null==e)return{};var o,r,t=function(e,a){if(null==e)return{};var o,r,t={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],a.indexOf(o)>=0||(t[o]=e[o]);return t}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}var p=t.a.createContext({}),l=function(e){var a=t.a.useContext(p),o=a;return e&&(o="function"==typeof e?e(a):n(n({},a),e)),o},d=function(e){var a=l(e.components);return t.a.createElement(p.Provider,{value:a},e.children)},b={inlineCode:"code",wrapper:function(e){var a=e.children;return t.a.createElement(t.a.Fragment,{},a)}},m=t.a.forwardRef((function(e,a){var o=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=l(o),m=r,u=d["".concat(s,".").concat(m)]||d[m]||b[m]||i;return o?t.a.createElement(u,n(n({ref:a},p),{},{components:o})):t.a.createElement(u,n({ref:a},p))}));function u(e,a){var o=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=o.length,s=new Array(i);s[0]=m;var n={};for(var c in a)hasOwnProperty.call(a,c)&&(n[c]=a[c]);n.originalType=e,n.mdxType="string"==typeof e?e:r,s[1]=n;for(var p=2;p<i;p++)s[p]=o[p];return t.a.createElement.apply(null,s)}return t.a.createElement.apply(null,o)}m.displayName="MDXCreateElement"},55:function(e,a,o){"use strict";o.r(a),o.d(a,"frontMatter",(function(){return s})),o.d(a,"metadata",(function(){return n})),o.d(a,"rightToc",(function(){return c})),o.d(a,"default",(function(){return l}));var r=o(2),t=o(6),i=(o(0),o(113)),s={id:"making-a-progressive-web-app",title:"Fazendo um Progressive Web App"},n={unversionedId:"making-a-progressive-web-app",id:"making-a-progressive-web-app",isDocsHomePage:!1,title:"Fazendo um Progressive Web App",description:"A constru\xe7\xe3o de produ\xe7\xe3o (build) tem todas as ferramentas necess\xe1rias para gerar um",source:"@site/..\\docs\\making-a-progressive-web-app.md",slug:"/making-a-progressive-web-app",permalink:"/create-react-app/docs/making-a-progressive-web-app",editUrl:"https://github.com/facebook/create-react-app/edit/master/docusaurus/website/../docs/making-a-progressive-web-app.md",version:"current",lastUpdatedBy:"Fernando Belotto",lastUpdatedAt:1609700542,sidebar:"docs",previous:{title:"Adicionando Vari\xe1veis \u200b\u200bde Ambiente Personalizadas",permalink:"/create-react-app/docs/adding-custom-environment-variables"},next:{title:"Medindo o desempenho",permalink:"/create-react-app/docs/measuring-performance"}},c=[{value:"Por que ativar?",id:"por-que-ativar",children:[]},{value:"Personaliza\xe7\xe3o",id:"personaliza\xe7\xe3o",children:[]},{value:"Considera\xe7\xf5es sobre Offline-First",id:"considera\xe7\xf5es-sobre-offline-first",children:[]},{value:"Metadata do Progressive Web App",id:"metadata-do-progressive-web-app",children:[]}],p={rightToc:c};function l(e){var a=e.components,o=Object(t.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},p,o,{components:a,mdxType:"MDXLayout"}),Object(i.b)("p",null,"A constru\xe7\xe3o de produ\xe7\xe3o (build) tem todas as ferramentas necess\xe1rias para gerar um\n",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/progressive-web-apps/"}),"Progressive Web App")," de primeira classe, mas ",Object(i.b)("strong",{parentName:"p"},"o comportamento offline/cache-first \xe9 apenas opicional"),"."),Object(i.b)("p",null,"A partir da vers\xe3o 4 do Create React App, voc\xea pode adicionar um arquivo ",Object(i.b)("inlineCode",{parentName:"p"},"src/service-worker.js")," ao seu projeto para usar o suporte integrado para ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/tools/plug-in"}),"Workbox"),"'s ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/tools/workbox/reference-docs/latest/module-workbox-webpack-plugin.InjectManifest"}),Object(i.b)("inlineCode",{parentName:"a"},"InjectManifest")),", que ir\xe1 ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/tools/workbox/guides/using-bundlers"}),"compilar")," seu service worker e injete nele uma lista de URLs para ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/tools/workbox/guides/precache-files"}),"pr\xe9-cache"),"."),Object(i.b)("p",null,"Se voc\xea iniciar um novo projeto usando um dos PWA ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://create-react-app.dev/docs/custom-templates/"}),"modelos personalizados"),", voc\xea obter\xe1 um arquivo ",Object(i.b)("inlineCode",{parentName:"p"},"src/service-worker.js")," que serve como um bom ponto de partida para um service worker off-line priorit\xe1rio:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"npx create-react-app my-app --template cra-template-pwa\n")),Object(i.b)("p",null,"O equivalente em TypeScript \xe9:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"npx create-react-app my-app --template cra-template-pwa-typescript\n")),Object(i.b)("p",null,"Se voc\xea sabe que n\xe3o usar\xe1 service workers, ou se preferir usar uma abordagem diferente para lidar com o service worker, n\xe3o crie um arquivo ",Object(i.b)("inlineCode",{parentName:"p"},"src/service-worker.js"),". O plugin ",Object(i.b)("inlineCode",{parentName:"p"},"InjectManifest")," n\xe3o ser\xe1 executado neste caso."),Object(i.b)("p",null,"In addition to creating your local ",Object(i.b)("inlineCode",{parentName:"p"},"src/service-worker.js")," file, it needs to be registered before it will be used. In order to opt-in to the offline-first behavior, developers should look for the following in their ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/blob/master/packages/cra-template/template/src/index.js"}),Object(i.b)("inlineCode",{parentName:"a"},"src/index.js")),"\nAl\xe9m de criar seu arquivo local ",Object(i.b)("inlineCode",{parentName:"p"},"src/service-worker.js"),", ele precisa ser registrado antes de ser usado. Para optar pelo comportamento offline-first, os desenvolvedores devem procurar em seu arquivo ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/blob/master/packages/cra-template/template/src/index.js"}),Object(i.b)("inlineCode",{parentName:"a"},"src/index.js")),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// Se voc\xea deseja que seu aplicativo funcione offline e carregue mais r\xe1pido, voc\xea pode alterar\n// unregister() para register() abaixo. Observe que isso traz algumas armadilhas.\n// Saiba mais sobre service workers: https://cra.link/PWA\nserviceWorker.unregister();\n")),Object(i.b)("p",null,"Como afirma o coment\xe1rio, alternar ",Object(i.b)("inlineCode",{parentName:"p"},"serviceWorker.unregister()")," para ",Object(i.b)("inlineCode",{parentName:"p"},"serviceWorker.register()")," ir\xe1 permitir que voc\xea use o service worker."),Object(i.b)("h2",{id:"por-que-ativar"},"Por que ativar?"),Object(i.b)("p",null,"Os Progressive Web Apps Offline-first s\xe3o mais r\xe1pidos e confi\xe1veis \u200b\u200bdo que as p\xe1ginas da web tradicionais e fornecem uma experi\xeancia m\xf3vel envolvente:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Todos os ativos est\xe1ticos do site que fazem parte da sua build ",Object(i.b)("inlineCode",{parentName:"li"},"webpack")," s\xe3o armazenados em cache para que sua p\xe1gina carregue rapidamente nas visitas subsequentes, independentemente da conectividade de rede (como 2G ou 3G). As atualiza\xe7\xf5es s\xe3o baixadas em segundo plano."),Object(i.b)("li",{parentName:"ul"},"Seu aplicativo funcionar\xe1 independentemente do estado da rede, mesmo offline. Isso significa que seus usu\xe1rios poder\xe3o usar seu aplicativo a 10.000 p\xe9s e no metr\xf4."),Object(i.b)("li",{parentName:"ul"},"Em dispositivos m\xf3veis, seu aplicativo pode ser adicionado diretamente \xe0 tela inicial do usu\xe1rio, \xedcone do aplicativo e tudo. Isso elimina a necessidade da loja de aplicativos.")),Object(i.b)("p",null,"However, they ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/issues/2398"}),"can make debugging deployments more challenging"),".\nNo entanto, eles ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/issues/2398"}),"podem tornar depura\xe7\xe3o de implanta\xe7\xe3o mais desafiadoras"),"."),Object(i.b)("p",null,"O ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/tools/workbox/modules/workbox-webpack-plugin"}),Object(i.b)("inlineCode",{parentName:"a"},"workbox-webpack-plugin"))," \xe9 integrado \xe0 configura\xe7\xe3o de produ\xe7\xe3o e se encarregar\xe1 de compilar um arquivo service worker que ir\xe1 pr\xe9-armazenar em cache automaticamente todos os seus ativos gerados pelo ",Object(i.b)("inlineCode",{parentName:"p"},"webpack")," e mant\xea-los atualizados conforme voc\xea implanta atualiza\xe7\xf5es. O service worker usar\xe1 uma ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-falling-back-to-network"}),"estrat\xe9gia de cache-first")," para lidar com todas as solicita\xe7\xf5es de recursos gerados pelo ",Object(i.b)("inlineCode",{parentName:"p"},"webpack"),", incluindo ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests"}),"solicita\xe7\xf5es de navega\xe7\xe3o")," para seu HTML, garantindo que seu aplicativo da web seja consistentemente r\xe1pido, mesmo em uma rede lenta ou n\xe3o confi\xe1vel."),Object(i.b)("p",null,"Nota: Recursos que n\xe3o s\xe3o gerados pelo ",Object(i.b)("inlineCode",{parentName:"p"},"webpack"),", como arquivos est\xe1ticos que s\xe3o copiados de seu ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/blob/master/packages/cra-template/template/public/"}),"diret\xf3rio local ",Object(i.b)("inlineCode",{parentName:"a"},"public/"))," ou recursos de terceiros, n\xe3o ser\xe3o pr\xe9-armazenados. Voc\xea pode configurar opcionalmente o Workbox ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/tools/workbox/guides/route-requests"}),"routes")," para aplicar a estrat\xe9gia de cache de tempo de execu\xe7\xe3o de sua escolha a esses recursos."),Object(i.b)("h2",{id:"personaliza\xe7\xe3o"},"Personaliza\xe7\xe3o"),Object(i.b)("p",null,"A partir do Create React App 4, voc\xea tem controle total sobre a personaliza\xe7\xe3o da l\xf3gica neste service worker, criando seu pr\xf3prio arquivo ",Object(i.b)("inlineCode",{parentName:"p"},"src/service-worker.js"),", ou personalizando aquele adicionado pelo template ",Object(i.b)("inlineCode",{parentName:"p"},"cra-template-pwa")," ( ou ",Object(i.b)("inlineCode",{parentName:"p"},"cra-template-pwa-typescript"),"). Voc\xea pode usar ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/tools/workbox/modules"}),"m\xf3dulos adicionais")," do projeto Workbox, adicionar uma biblioteca de notifica\xe7\xe3o push ou remover parte da l\xf3gica de cache padr\xe3o. O \xfanico requisito \xe9 que voc\xea mantenha ",Object(i.b)("inlineCode",{parentName:"p"},"self.__WB_MANIFEST")," em algum lugar em seu arquivo, j\xe1 que o plugin de compila\xe7\xe3o do Workbox verifica este valor ao gerar um manifesto de URLs para pr\xe9-armazenar em cache. Se voc\xea preferir n\xe3o usar o precaching, pode atribuir ",Object(i.b)("inlineCode",{parentName:"p"},"self.__WB_MANIFEST")," a uma vari\xe1vel que ser\xe1 ignorada, como:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// eslint-disable-next-line no-restricted-globals\nconst ignored = self.__WB_MANIFEST;\n\n// Seu c\xf3digo do service worker customizado vai aqui.\n")),Object(i.b)("h2",{id:"considera\xe7\xf5es-sobre-offline-first"},"Considera\xe7\xf5es sobre Offline-First"),Object(i.b)("p",null,"Se voc\xea decidir aceitar o registro do service worker, leve em considera\xe7\xe3o o seguinte:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Depois que o cache inicial \xe9 feito, o ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle"}),"ciclo de vida do service worker")," controla quando o conte\xfado atualizado acaba sendo mostrado aos usu\xe1rios. Para se proteger contra ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/issues/3613#issuecomment-353467430"}),"condi\xe7\xf5es de corrida com conte\xfado carregado lentamente"),', o comportamento padr\xe3o \xe9 manter o servi\xe7o atualizado de forma conservadora trabalhador no estado "',Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#waiting"}),"em espera"),'". Isso significa que os usu\xe1rios acabar\xe3o vendo o conte\xfado mais antigo at\xe9 que fechem (recarregar n\xe3o \xe9 suficiente) suas guias abertas existentes. Consulte ',Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://jeffy.info/2018/10/10/sw-in-c-r-a.html"}),"esta postagem do blog")," para obter mais detalhes sobre esse comportamento.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Os usu\xe1rios nem sempre est\xe3o familiarizados com os aplicativos da web offline. Pode ser \xfatil ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/fundamentals/instant-and-offline/offline-ux#inform_the_user_when_the_app_is_ready_for_offline_consumption"}),"informar o usu\xe1rio"),' quando o service worker terminar de preencher seus caches (mostrando um Mensagem "Este aplicativo da web funciona offline!") E tamb\xe9m inform\xe1-los quando o service worker tiver obtido as atualiza\xe7\xf5es mais recentes que estar\xe3o dispon\xedveis na pr\xf3xima vez que carregar a p\xe1gina (mostrando uma mensagem "Novo conte\xfado dispon\xedvel assim que as guias existentes forem fechadas".). Mostrar essas mensagens \xe9 deixado como um exerc\xedcio para o desenvolvedor, mas como ponto de partida, voc\xea pode fazer uso da l\xf3gica inclu\xedda em ',Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/blob/master/packages/cra-template/template/src/serviceWorker.js"}),Object(i.b)("inlineCode",{parentName:"a"},"src/serviceWorker.js")),", que demonstra quais eventos do ciclo de vida do service worker ouvir para detectar cada cen\xe1rio e que, por padr\xe3o, registra apenas as mensagens apropriadas para o Console JavaScript.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Service workers ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/fundamentals/getting-started/primers/service-workers#you_need_https"}),"requerem HTTPS"),", embora para facilitar o teste local, essa pol\xedtica ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://stackoverflow.com/questions/34160509/options-for-testing-service-workers-via-http/34161385#34161385"}),"n\xe3o se aplica a ",Object(i.b)("inlineCode",{parentName:"a"},"localhost")),". Se o seu servidor web de produ\xe7\xe3o n\xe3o for compat\xedvel com HTTPS, o registro do service worker falhar\xe1, mas o resto do seu aplicativo web permanecer\xe1 funcional.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"O service worker est\xe1 habilitado apenas no ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"/create-react-app/docs/deployment"}),"ambiente de produ\xe7\xe3o"),", por exemplo, a sa\xedda de ",Object(i.b)("inlineCode",{parentName:"p"},"npm run build"),". \xc9 recomend\xe1vel que voc\xea n\xe3o habilite um service worker off-line-first em um ambiente de desenvolvimento, pois isso pode causar frustra\xe7\xe3o quando ativos armazenados em cache anteriormente s\xe3o usados \u200b\u200be n\xe3o incluem as altera\xe7\xf5es mais recentes feitas localmente.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Se voc\xea ",Object(i.b)("em",{parentName:"p"},"precisa")," testar seu service worker offline-first localmente, construa o aplicativo (usando ",Object(i.b)("inlineCode",{parentName:"p"},"npm run build"),") e execute um servidor http padr\xe3o a partir de seu diret\xf3rio de constru\xe7\xe3o. Depois de executar o script de constru\xe7\xe3o, ",Object(i.b)("inlineCode",{parentName:"p"},"create-react-app")," dar\xe1 instru\xe7\xf5es para uma maneira de testar sua constru\xe7\xe3o de produ\xe7\xe3o localmente e as ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"/create-react-app/docs/deployment"}),"instru\xe7\xf5es de implanta\xe7\xe3o")," tem instru\xe7\xf5es para usar outros m\xe9todos. ",Object(i.b)("em",{parentName:"p"},"Certifique-se de usar sempre uma janela an\xf4nima para evitar complica\xe7\xf5es com o cache do navegador."))),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Por padr\xe3o, o arquivo do service worker gerado n\xe3o interceptar\xe1 ou armazenar\xe1 em cache qualquer tr\xe1fego de origem cruzada, como HTTP ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"/create-react-app/docs/integrating-with-an-api-backend"}),"solicita\xe7\xf5es de API"),", imagens ou incorpora\xe7\xf5es carregadas de um dom\xednio diferente. A partir do Create React App 4, ele pode ser personalizado, conforme explicado acima."))),Object(i.b)("h2",{id:"metadata-do-progressive-web-app"},"Metadata do Progressive Web App"),Object(i.b)("p",null,"A configura\xe7\xe3o padr\xe3o inclui um manifesto de aplicativo da web localizado em ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/blob/master/packages/cra-template/template/public/manifest.json"}),Object(i.b)("inlineCode",{parentName:"a"},"public/manifest.json")),", que voc\xea pode personalizar com detalhes espec\xedficos para seu aplicativo da web."),Object(i.b)("p",null,"Quando um usu\xe1rio adiciona um aplicativo da web \xe0 tela inicial usando o Chrome ou Firefox no\nAndroid, os metadados em ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/facebook/create-react-app/blob/master/packages/cra-template/template/public/manifest.json"}),Object(i.b)("inlineCode",{parentName:"a"},"manifest.json"))," determina o que\n\xedcones, nomes e cores de marca a serem usados \u200b\u200bquando o aplicativo da web for exibido.\n",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/"}),"Guia do Manifesto do Aplicativo da Web")," fornece mais contexto sobre o que cada campo significa e como suas personaliza\xe7\xf5es afetar\xe1 a experi\xeancia de seus usu\xe1rios."),Object(i.b)("p",null,"Progressive Web Apps que foram adicionados \xe0 tela inicial ser\xe3o carregados mais rapidamente e v\xe3o funcionar offline quando houver um service worker ativo. Dito isto, os metadados do manifesto do aplicativo da web ainda ser\xe3o usados \u200b\u200bindependentemente de n\xe3o voc\xea opta pelo registro do service worker."))}l.isMDXComponent=!0}}]);